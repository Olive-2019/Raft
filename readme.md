# 可分片分布式容错数据库
参考Mit6.824的后三个实验，逐步实现该数据库
## 线性一致性保证
底层实现Raft协议以保证命令执行的线性一致性，其详细设计在(Raft)[https://github.com/Olive-2019/Raft/blob/master/Raft/readme.md]中。
## 数据库功能
在Raft之上实现的数据库。抽象来说就是两层，一层是较为赤裸的执行引擎，将命令传递给Raft系统，又等待Raft系统同步后执行；另一个是面向用户的命令封装层，将用户调用的接口封装成命令给执行引擎。其详细设计位于(KV Server)[https://github.com/Olive-2019/Raft/blob/master/Client/readme.md]中。
## 持久化
本系统存在两个需要持久化的内容，一个是Raft系统命令的持久化，一个是数据库的快照。前者是为了减少内存消耗，后者是为了恢复状态，二者不完全统一，但有一定关系。

**Raft系统命令持久化**：Raft命令数量达到一定阈值后，会将当前时刻之前的命令写磁盘，并在内存中删除。宕机后恢复状态时，从磁盘中读命令恢复状态。
**数据库快照**：数据库运行一段时间就要将自己的状态写一次快照，写快照时需要将Raft系统中当前状态之前执行的命令删除。宕机后恢复状态时，可从快照恢复，并执行Raft系统的恢复指令，可近似达到宕机前状态。

数据库快照持久化会影响Raft系统命令持久化（删除），持久化的Raft系统命令和内存中的Raft系统命令会帮助系统从快照恢复到近期状态。

## 分片
通过分片控制器管理系统配置（分片和服务器集群的对应关系），分片数据库每隔一段时间都会从控制器拉取配置信息，并更新自己的状态/迁移数据。

